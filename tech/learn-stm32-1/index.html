<!doctype html><html lang=zh-CN><head prefix="og: http://ogp.me/ns# article: http://ogp.me/ns/article#"><meta charset=UTF-8><meta name=generator content="Hugo 0.121.2"><meta name=theme-color content="#fcfaf2"><meta name=color-scheme content="light dark"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=format-detection content="telephone=no, date=no, address=no, email=no"><meta http-equiv=Cache-Control content="no-transform"><meta http-equiv=Cache-Control content="no-siteapp"><title>Learn STM32 the Hard Way·1 从点灯开始 | Evergarden</title>
<link rel=stylesheet href=/css/meme.min.2a277f46af130eb289d63608dda72fd5204c60336f4ad429571346263a287b04.css><script src=/js/meme.min.f8950bd7ff7f94df838144d3d717223c2b5d2c98f19f0b6656cac5b87a2a8c97.js></script><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Merriweather%7cAllura%7cCinzel+Decorative%7cEB+Garamond:ital,wght@0,400;0,500;0,700;1,400;1,700%7cFira+Code:ital,wght@0,400;0,700;1,400;1,700%7cNoto+Serif+SC:wght@400;500;700&amp;display=swap&amp;subset=chinese-simplified" media=print onload='this.media="all"'><noscript><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Merriweather%7cAllura%7cCinzel+Decorative%7cEB+Garamond:ital,wght@0,400;0,500;0,700;1,400;1,700%7cFira+Code:ital,wght@0,400;0,700;1,400;1,700%7cNoto+Serif+SC:wght@400;500;700&amp;display=swap&amp;subset=chinese-simplified"></noscript><meta name=author content="EvernessW"><meta name=description content="What's the hard way? 网上已经有许多非常成熟的基于Keil的STM32的开发教程，而本系列文章反其……"><link rel="shortcut icon" href=/favicon.ico type=image/x-icon><link rel=mask-icon href=/icons/safari-pinned-tab.svg color=#9cf><link rel=apple-touch-icon sizes=180x180 href=/icons/apple-touch-icon.png><meta name=apple-mobile-web-app-capable content="yes"><meta name=apple-mobile-web-app-title content="Evergarden"><meta name=apple-mobile-web-app-status-bar-style content="black"><meta name=mobile-web-app-capable content="yes"><meta name=application-name content="Evergarden"><meta name=msapplication-starturl content="../../"><meta name=msapplication-TileColor content="#fcfaf2"><meta name=msapplication-TileImage content="../../icons/mstile-150x150.png"><link rel=manifest href=/manifest.json><link rel=canonical href=https://ioyoi.me/tech/learn-stm32-1/><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","datePublished":"2024-01-09T21:00:50+08:00","dateModified":"2024-01-15T18:52:12+00:00","url":"https://ioyoi.me/tech/learn-stm32-1/","headline":"Learn STM32 the Hard Way·1 从点灯开始","description":"What's the hard way? 网上已经有许多非常成熟的基于Keil的STM32的开发教程，而本系列文章反其……","inLanguage":"zh-CN","articleSection":"tech","wordCount":5935,"image":["https://img.ioyoi.me/20240109171831.webp","https://img.ioyoi.me/20240109191257.webp","https://img.ioyoi.me/20240109190117.webp","https://img.ioyoi.me/20240109190258.webp","https://img.ioyoi.me/20240109191436.webp","https://img.ioyoi.me/20240109191658.webp","https://img.ioyoi.me/20240109192001.webp","https://img.ioyoi.me/20240109193005.webp","https://img.ioyoi.me/20240109195017.webp","https://img.ioyoi.me/20240109200544.webp","https://img.ioyoi.me/20240109201405.webp","https://img.ioyoi.me/20240109203102.webp","https://img.ioyoi.me/20240109203035.webp","https://img.ioyoi.me/20240109204947.webp","https://img.ioyoi.me/20240110121901.webp","https://img.ioyoi.me/20240110121902.webp","https://img.ioyoi.me/20240110123154.webp"],"author":{"@type":"Person","description":"To discover. To change.","email":"3verness@gmail.com","image":"https://ioyoi.me/icons/apple-touch-icon.png","url":"https://ioyoi.me/","name":"EvernessW"},"license":"[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)","publisher":{"@type":"Organization","name":"Evergarden","logo":{"@type":"ImageObject","url":"https://ioyoi.me/icons/apple-touch-icon.png"},"url":"https://ioyoi.me/"},"mainEntityOfPage":{"@type":"WebSite","@id":"https://ioyoi.me/"}}</script><meta name=twitter:card content="summary_large_image"><meta name=twitter:site content="@ShaohangWang"><meta name=twitter:creator content="@ShaohangWang"><meta property="og:title" content="Learn STM32 the Hard Way·1 从点灯开始"><meta property="og:description" content="What's the hard way? 网上已经有许多非常成熟的基于Keil的STM32的开发教程，而本系列文章反其……"><meta property="og:url" content="https://ioyoi.me/tech/learn-stm32-1/"><meta property="og:site_name" content="Evergarden"><meta property="og:locale" content="zh"><meta property="og:image" content="https://img.ioyoi.me/20240109171831.webp"><meta property="og:type" content="article"><meta property="article:published_time" content="2024-01-09T21:00:50+08:00"><meta property="article:modified_time" content="2024-01-15T18:52:12+00:00"><meta property="article:section" content="tech"><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css></head><body><div class=container><header class=header><div class=header-wrapper><div class="header-inner single"><div class=site-brand><a href=/ class=brand>Evergarden</a></div><nav class=nav><ul class=menu id=menu><li class=menu-item><a href=/life/><span class=menu-item-name>life</span></a></li><li class=menu-item><a href=/tech/><span class=menu-item-name>tech</span></a></li><li class=menu-item><a href=/dream/><span class=menu-item-name>dream</span></a></li><li class=menu-item><a href=/me/><span class=menu-item-name>me</span></a></li><li class=menu-item><a id=theme-switcher href=#><svg t="1589722483728" class="icon theme-icon-light" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" p-id="658" width="200" height="200"><path d="M320 85.333333C243.626667 134.4 192 221.013333 192 320s51.626667 185.6 129.28 234.666667c-130.986667.0-235.946667-104.96-235.946667-234.666667A234.666667 234.666667.0 01320 85.333333m493.653333 64 61.013334 61.013334-664.32 664.32-61.013334-61.013334 664.32-664.32m-263.68 103.68L486.826667 213.333333 425.386667 256l17.92-72.533333L384 138.24l74.666667-5.12 24.746666-70.4L512 132.266667l73.813333 1.28-57.6 48.213333 21.76 71.253333m-140.8 154.026667L359.68 375.893333l-47.786667 33.28 14.506667-56.32L279.893333 317.44 337.92 313.6l19.2-55.04 21.76 54.186667 58.026667 1.28-44.8 37.12L409.173333 407.04M810.666667 576A234.666667 234.666667.0 01576 810.666667c-52.053333.0-100.266667-17.066667-139.093333-45.653334l328.106666-328.106666C793.6 475.733334 810.666666 523.946667 810.666667 576M622.933333 856.746667 741.12 807.68l-10.24 142.933333-107.946667-93.866666m184.746667-115.2L856.746667 623.36l93.866666 108.373333L807.68 741.546667M856.746667 529.92l-48.64-118.613333 142.506666 10.24L856.746667 529.92M410.88 807.68l118.186667 49.066667-107.946667 93.44L410.88 807.68z" fill="" p-id="659"/></svg><svg t="1589722483728" class="icon theme-icon-dark" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" p-id="658" width="200" height="200"><path d="M320 85.333333C243.626667 134.4 192 221.013333 192 320s51.626667 185.6 129.28 234.666667c-130.986667.0-235.946667-104.96-235.946667-234.666667A234.666667 234.666667.0 01320 85.333333m493.653333 64 61.013334 61.013334-664.32 664.32-61.013334-61.013334 664.32-664.32m-263.68 103.68L486.826667 213.333333 425.386667 256l17.92-72.533333L384 138.24l74.666667-5.12 24.746666-70.4L512 132.266667l73.813333 1.28-57.6 48.213333 21.76 71.253333m-140.8 154.026667L359.68 375.893333l-47.786667 33.28 14.506667-56.32L279.893333 317.44 337.92 313.6l19.2-55.04 21.76 54.186667 58.026667 1.28-44.8 37.12L409.173333 407.04M810.666667 576A234.666667 234.666667.0 01576 810.666667c-52.053333.0-100.266667-17.066667-139.093333-45.653334l328.106666-328.106666C793.6 475.733334 810.666666 523.946667 810.666667 576M622.933333 856.746667 741.12 807.68l-10.24 142.933333-107.946667-93.866666m184.746667-115.2L856.746667 623.36l93.866666 108.373333L807.68 741.546667M856.746667 529.92l-48.64-118.613333 142.506666 10.24L856.746667 529.92M410.88 807.68l118.186667 49.066667-107.946667 93.44L410.88 807.68z" fill="" p-id="659"/></svg></a></li></ul></nav></div></div><input type=checkbox id=nav-toggle aria-hidden=true>
<label for=nav-toggle class=nav-toggle></label>
<label for=nav-toggle class=nav-curtain></label></header><main class="main single" id=main><div class=main-inner><article class="content post h-entry" data-align=justify data-type=tech data-toc-num=true><h1 class="post-title p-name">Learn STM32 the Hard Way·1 从点灯开始</h1><div class="post-subtitle p-name">基于GNU GCC、OpenOCD开源工具链的STM32入门</div><div class=post-meta><time datetime=2024-01-09T21:00:50+08:00 class="post-meta-item published dt-published"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512" class="icon post-meta-icon"><path d="M148 288h-40c-6.6.0-12-5.4-12-12v-40c0-6.6 5.4-12 12-12h40c6.6.0 12 5.4 12 12v40c0 6.6-5.4 12-12 12zm108-12v-40c0-6.6-5.4-12-12-12h-40c-6.6.0-12 5.4-12 12v40c0 6.6 5.4 12 12 12h40c6.6.0 12-5.4 12-12zm96 0v-40c0-6.6-5.4-12-12-12h-40c-6.6.0-12 5.4-12 12v40c0 6.6 5.4 12 12 12h40c6.6.0 12-5.4 12-12zm-96 96v-40c0-6.6-5.4-12-12-12h-40c-6.6.0-12 5.4-12 12v40c0 6.6 5.4 12 12 12h40c6.6.0 12-5.4 12-12zm-96 0v-40c0-6.6-5.4-12-12-12h-40c-6.6.0-12 5.4-12 12v40c0 6.6 5.4 12 12 12h40c6.6.0 12-5.4 12-12zm192 0v-40c0-6.6-5.4-12-12-12h-40c-6.6.0-12 5.4-12 12v40c0 6.6 5.4 12 12 12h40c6.6.0 12-5.4 12-12zm96-260v352c0 26.5-21.5 48-48 48H48c-26.5.0-48-21.5-48-48V112c0-26.5 21.5-48 48-48h48V12c0-6.6 5.4-12 12-12h40c6.6.0 12 5.4 12 12v52h128V12c0-6.6 5.4-12 12-12h40c6.6.0 12 5.4 12 12v52h48c26.5.0 48 21.5 48 48zm-48 346V160H48v298c0 3.3 2.7 6 6 6h340c3.3.0 6-2.7 6-6z"/></svg>&nbsp;2024.1.9</time>
<time datetime=2024-01-15T18:52:12+00:00 class="post-meta-item modified dt-updated"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512" class="icon post-meta-icon"><path d="M4e2 64h-48V12c0-6.627-5.373-12-12-12h-40c-6.627.0-12 5.373-12 12v52H160V12c0-6.627-5.373-12-12-12h-40c-6.627.0-12 5.373-12 12v52H48C21.49 64 0 85.49.0 112v352c0 26.51 21.49 48 48 48h352c26.51.0 48-21.49 48-48V112c0-26.51-21.49-48-48-48zm-6 4e2H54a6 6 0 01-6-6V160h352v298a6 6 0 01-6 6zm-52.849-200.65L198.842 404.519c-4.705 4.667-12.303 4.637-16.971-.068l-75.091-75.699c-4.667-4.705-4.637-12.303.068-16.971l22.719-22.536c4.705-4.667 12.303-4.637 16.97.069l44.104 44.461 111.072-110.181c4.705-4.667 12.303-4.637 16.971.068l22.536 22.718c4.667 4.705 4.636 12.303-.069 16.97z"/></svg>&nbsp;2024.1.15</time>
<span class="post-meta-item category"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" class="icon post-meta-icon"><path d="M464 128H272l-54.63-54.63c-6-6-14.14-9.37-22.63-9.37H48C21.49 64 0 85.49.0 112v288c0 26.51 21.49 48 48 48h416c26.51.0 48-21.49 48-48V176c0-26.51-21.49-48-48-48zm0 272H48V112h140.12l54.63 54.63c6 6 14.14 9.37 22.63 9.37H464v224z"/></svg>&nbsp;<a href=/tech/ class="category-link p-category">Tech</a></span>
<span class="post-meta-item wordcount"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" class="icon post-meta-icon"><path d="M497.9 142.1l-46.1 46.1c-4.7 4.7-12.3 4.7-17 0l-111-111c-4.7-4.7-4.7-12.3.0-17l46.1-46.1c18.7-18.7 49.1-18.7 67.9.0l60.1 60.1c18.8 18.7 18.8 49.1.0 67.9zM284.2 99.8 21.6 362.4.4 483.9c-2.9 16.4 11.4 30.6 27.8 27.8l121.5-21.3 262.6-262.6c4.7-4.7 4.7-12.3.0-17l-111-111c-4.8-4.7-12.4-4.7-17.1.0zM124.1 339.9c-5.5-5.5-5.5-14.3.0-19.8l154-154c5.5-5.5 14.3-5.5 19.8.0s5.5 14.3.0 19.8l-154 154c-5.5 5.5-14.3 5.5-19.8.0zM88 424h48v36.3l-64.5 11.3-31.1-31.1L51.7 376H88v48z"/></svg>&nbsp;5935</span>
<span class="post-meta-item reading-time"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" class="icon post-meta-icon"><path d="M256 8C119 8 8 119 8 256s111 248 248 248 248-111 248-248S393 8 256 8zm0 448c-110.5.0-2e2-89.5-2e2-2e2S145.5 56 256 56s2e2 89.5 2e2 2e2-89.5 2e2-2e2 2e2zm61.8-104.4-84.9-61.7c-3.1-2.3-4.9-5.9-4.9-9.7V116c0-6.6 5.4-12 12-12h32c6.6.0 12 5.4 12 12v141.7l66.8 48.6c5.4 3.9 6.5 11.4 2.6 16.8L334.6 349c-3.9 5.3-11.4 6.5-16.8 2.6z"/></svg>&nbsp;12&nbsp;min</span></div><div class="post-body e-content"><h2 id=whats-the-hard-way><a href=#whats-the-hard-way class=anchor-link><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" class="icon anchor-icon"><path d="M326.612 185.391c59.747 59.809 58.927 155.698.36 214.59-.11.12-.24.25-.36.37l-67.2 67.2c-59.27 59.27-155.699 59.262-214.96.0-59.27-59.26-59.27-155.7.0-214.96l37.106-37.106c9.84-9.84 26.786-3.3 27.294 10.606.648 17.722 3.826 35.527 9.69 52.721 1.986 5.822.567 12.262-3.783 16.612l-13.087 13.087c-28.026 28.026-28.905 73.66-1.155 101.96 28.024 28.579 74.086 28.749 102.325.51l67.2-67.19c28.191-28.191 28.073-73.757.0-101.83-3.701-3.694-7.429-6.564-10.341-8.569a16.037 16.037.0 01-6.947-12.606c-.396-10.567 3.348-21.456 11.698-29.806l21.054-21.055c5.521-5.521 14.182-6.199 20.584-1.731a152.482 152.482.0 0120.522 17.197zM467.547 44.449c-59.261-59.262-155.69-59.27-214.96.0l-67.2 67.2c-.12.12-.25.25-.36.37-58.566 58.892-59.387 154.781.36 214.59a152.454 152.454.0 0020.521 17.196c6.402 4.468 15.064 3.789 20.584-1.731l21.054-21.055c8.35-8.35 12.094-19.239 11.698-29.806a16.037 16.037.0 00-6.947-12.606c-2.912-2.005-6.64-4.875-10.341-8.569-28.073-28.073-28.191-73.639.0-101.83l67.2-67.19c28.239-28.239 74.3-28.069 102.325.51 27.75 28.3 26.872 73.934-1.155 101.96l-13.087 13.087c-4.35 4.35-5.769 10.79-3.783 16.612 5.864 17.194 9.042 34.999 9.69 52.721.509 13.906 17.454 20.446 27.294 10.606l37.106-37.106c59.271-59.259 59.271-155.699.001-214.959z"/></svg></a>What's the hard way?</h2><p>网上已经有许多非常成熟的基于Keil的STM32的开发教程，而本系列文章反其道而行之，选择使用GNU GCC + OpenOCD的开源工具链进行STM32的入门；本系列教程计划以江协科技的<a href="https://item.taobao.com/item.htm?id=655451342180" target=_blank rel=noopener>STM32开发套件</a>为基础，依次进行STM32标准库开发与HAL库开发的学习，由于作者也是刚刚接触STM32的萌新，文章可能出现诸多纰漏，欢迎读者批评指正。</p><div class="note primary"><p>为什么不使用Keil？</p><ol><li>Keil是昂贵的商业软件，虽然大部分教程都提供了破解版使用，但这并非长久之策；</li><li>Keil仅支持Windows平台，无法在MacOS、Linux上进行跨平台开发；</li><li>Keil对与C的新标准支持较慢，如果你主要使用C++，那么GNU GCC是一个更好的选择；</li><li>使用开源工具链进行开发，可以对STM32的编译、链接、烧写过程有更加深入的认识；</li><li>开源工具链可以和诸多通用工具链进行联动，灵活性更高，便于后续的CI/CD。</li></ol><p>Anyway，工具只是工具，当我们了解其原理后，可以很快的从一种工具链迁移至另一种。</p></div><div class="note info"><p>如果你想一步步跟随本文的脚步去学习，强烈建议你购买与作者完全相同的套件，否则可能会在第一步就会遇到诸如OpenOCD无法连接、链接文件不合适等bug。</p></div><h2 id=lets-get-prepared><a href=#lets-get-prepared class=anchor-link><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" class="icon anchor-icon"><path d="M326.612 185.391c59.747 59.809 58.927 155.698.36 214.59-.11.12-.24.25-.36.37l-67.2 67.2c-59.27 59.27-155.699 59.262-214.96.0-59.27-59.26-59.27-155.7.0-214.96l37.106-37.106c9.84-9.84 26.786-3.3 27.294 10.606.648 17.722 3.826 35.527 9.69 52.721 1.986 5.822.567 12.262-3.783 16.612l-13.087 13.087c-28.026 28.026-28.905 73.66-1.155 101.96 28.024 28.579 74.086 28.749 102.325.51l67.2-67.19c28.191-28.191 28.073-73.757.0-101.83-3.701-3.694-7.429-6.564-10.341-8.569a16.037 16.037.0 01-6.947-12.606c-.396-10.567 3.348-21.456 11.698-29.806l21.054-21.055c5.521-5.521 14.182-6.199 20.584-1.731a152.482 152.482.0 0120.522 17.197zM467.547 44.449c-59.261-59.262-155.69-59.27-214.96.0l-67.2 67.2c-.12.12-.25.25-.36.37-58.566 58.892-59.387 154.781.36 214.59a152.454 152.454.0 0020.521 17.196c6.402 4.468 15.064 3.789 20.584-1.731l21.054-21.055c8.35-8.35 12.094-19.239 11.698-29.806a16.037 16.037.0 00-6.947-12.606c-2.912-2.005-6.64-4.875-10.341-8.569-28.073-28.073-28.191-73.639.0-101.83l67.2-67.19c28.239-28.239 74.3-28.069 102.325.51 27.75 28.3 26.872 73.934-1.155 101.96l-13.087 13.087c-4.35 4.35-5.769 10.79-3.783 16.612 5.864 17.194 9.042 34.999 9.69 52.721.509 13.906 17.454 20.446 27.294 10.606l37.106-37.106c59.271-59.259 59.271-155.699.001-214.959z"/></svg></a>Let's get prepared!</h2><p>让我们从配置开发环境开始吧，需要安装的工具全部可以从官方网站<strong>免费</strong>下载：</p><ul><li><p><a href=https://developer.arm.com/downloads/-/gnu-rm target=_blank rel=noopener>GNU Arm Embedded Toolchain</a></p><p>Arm编译工具，可以通过scoop进行安装管理：</p><div class=highlight><div class=chroma><div class=table-container><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>scoop install gcc-arm-none-eabi
</span></span></code></pre></td></tr></table></div></div></div></li><li><p><a href=https://openocd.org/ target=_blank rel=noopener>OpenOCD</a></p><p>调试器，也可以使用类似的<a href=https://pyocd.io/ target=_blank rel=noopener>pyOCD</a>等调试工具，但OpenOCD的资料教程最多，同样可以通过scoop安装：</p><div class=highlight><div class=chroma><div class=table-container><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>scoop install openocd
</span></span></code></pre></td></tr></table></div></div></div></li><li><p><a href=https://code.visualstudio.com/ target=_blank rel=noopener>VS Code</a></p><p>理论上你可以使用任意编辑器，比如Eclipse和Clion，它们都通过插件提供了很好的嵌入式开发支持。</p></li><li><p><a href=https://em-ide.com/zh-cn/ target=_blank rel=noopener>Embedded IDE</a></p><p>VS Code中的嵌入式开发插件，功能十分强大，在插件中搜索<code>eide</code>安装即可；</p></li><li><p><a href="https://marketplace.visualstudio.com/items?itemName=marus25.cortex-debug" target=_blank rel=noopener>Cortex-Debug</a></p><p>VS Code中的Cortex-M调试插件，在插件中搜索<code>cortex-debug</code>安装；</p></li><li><p><a href="https://marketplace.visualstudio.com/items?itemName=ms-vscode.cpptools-extension-pack" target=_blank rel=noopener>C/C++ Extension Pack</a></p><p>VS Code中的C语言支持，进行语法检查和输入提示，在插件中搜索<code>c</code>安装。</p></li></ul><p>完成软件安装后，需要自行设置Embedded-IDE与Cortex-Debug中的GCC路径和OpenOCD路径。</p><p>此外，为了完成库函数与HAL库的学习，还需要准备：</p><ul><li><p><a href=https://www.st.com/en/development-tools/stm32cubemx.html target=_blank rel=noopener>STM32Cube</a></p><p>STM32官方提供的代码生成器工具，常用于HAL库开发，并可以帮助我们生成一些GCC需要使用的配置文件；</p></li><li><p><a href=https://www.st.com/en/embedded-software/stm32-standard-peripheral-libraries.html target=_blank rel=noopener>STM32标准库</a></p><p>提供库函数的头文件与实现，对与我们的套件，应当下载<a href=https://www.st.com/en/embedded-software/stsw-stm32054.html target=_blank rel=noopener>STM32F10x standard peripheral library</a>；</p></li><li><p><a href=https://www.st.com/en/development-tools/stsw-link009.html target=_blank rel=noopener>ST-Link驱动</a></p><p>调试器驱动，如果你购买了不一样的套件，可能会搭配DAQ调试器，需要自行查找驱动安装。</p></li></ul><h2 id=创建第一个工程><a href=#创建第一个工程 class=anchor-link><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" class="icon anchor-icon"><path d="M326.612 185.391c59.747 59.809 58.927 155.698.36 214.59-.11.12-.24.25-.36.37l-67.2 67.2c-59.27 59.27-155.699 59.262-214.96.0-59.27-59.26-59.27-155.7.0-214.96l37.106-37.106c9.84-9.84 26.786-3.3 27.294 10.606.648 17.722 3.826 35.527 9.69 52.721 1.986 5.822.567 12.262-3.783 16.612l-13.087 13.087c-28.026 28.026-28.905 73.66-1.155 101.96 28.024 28.579 74.086 28.749 102.325.51l67.2-67.19c28.191-28.191 28.073-73.757.0-101.83-3.701-3.694-7.429-6.564-10.341-8.569a16.037 16.037.0 01-6.947-12.606c-.396-10.567 3.348-21.456 11.698-29.806l21.054-21.055c5.521-5.521 14.182-6.199 20.584-1.731a152.482 152.482.0 0120.522 17.197zM467.547 44.449c-59.261-59.262-155.69-59.27-214.96.0l-67.2 67.2c-.12.12-.25.25-.36.37-58.566 58.892-59.387 154.781.36 214.59a152.454 152.454.0 0020.521 17.196c6.402 4.468 15.064 3.789 20.584-1.731l21.054-21.055c8.35-8.35 12.094-19.239 11.698-29.806a16.037 16.037.0 00-6.947-12.606c-2.912-2.005-6.64-4.875-10.341-8.569-28.073-28.073-28.191-73.639.0-101.83l67.2-67.19c28.239-28.239 74.3-28.069 102.325.51 27.75 28.3 26.872 73.934-1.155 101.96l-13.087 13.087c-4.35 4.35-5.769 10.79-3.783 16.612 5.864 17.194 9.042 34.999 9.69 52.721.509 13.906 17.454 20.446 27.294 10.606l37.106-37.106c59.271-59.259 59.271-155.699.001-214.959z"/></svg></a>创建第一个工程</h2><p>打开VS Code左侧Embedded-IDE标签页，选择New Project->Empty Project->Cortex-M Project，输入项目名称、保存位置后右下角弹出跳转到项目选项，点击Continue进入项目。</p><p>首先我们需要从下载的标准库拷贝一些必需的头文件，按照江协教程，我们可以在项目中新建一个<code>Start</code>文件夹存放这些文件，以下文件均位于<code>Libraries\CMSIS\CM3</code>中：</p><ul><li><p><code>CoreSupport\core_cm3.h/c</code></p><p>支持Cortex-M3处理器核的CMSIS库文件，包含了一些与Cortex-M3处理器核相关的核心函数和宏定义；</p></li><li><p><code>DeviceSupport\ST\STM32F10x\stm32f10x.h</code></p><p>用于STM32F10x系列微控制器的头文件，包含了与STM32F10x相关的寄存器定义、位操作宏和其他硬件相关信息；</p></li><li><p><code>DeviceSupport\ST\STM32F10x\system_stm32f10x.h/c</code></p><p>用于STM32F10x系列微控制器的系统初始化配置文件，主要包含了系统时钟初始化和启动代码，用于设置系统时钟、中断向量表以及一些基本的系统配置；</p></li><li><p><code>DeviceSupport\ST\STM32F10x\startup\gcc_ride7\startup_stm32f10x_md.s</code></p><p>微控制器的启动文件，这是一个汇编文件，其主要目的是在微控制器上电时初始化系统并将控制权传递给用户的C语言程序。这个启动文件是连接到用户程序的二进制文件中的，确保在运行时系统能够正确初始化，并且用户程序可以正常执行。</p><div class="note primary"><p>可以注意到startup下存在着多个文件夹，分别对应着多种编译工具，每个文件夹下又提供过了多个<code>strtup_stm32f10x_xx.s</code>文件，具体拷贝哪一个需要跟据我们的微控制器芯片选择，可以参考<code>stm32f10x.h</code>中的说明进行选择：</p><p><img src=https://img.ioyoi.me/20240109171831.webp alt=image-20240109171828990></p><p>套件中的STM32F103C8T6为64Kbytes的STM32F103xx为控制器，应选择<code>STM32F10X_MD</code>，同时还要在预处理器加入该定义，这个操作将在下文中讲到。</p></div></li></ul><p>此外还需要一个链接脚本文件，用于指示链接器在构建可执行文件时如何组织代码和数据，以及如何分配它们到微控制器的存储器空间，该文件有两种获取方式，一种是直接在网上查找其他人使用的对应控制器的<a href=https://github.com/lucysrausch/stm32-turbotronik/blob/master/STM32F103C8Tx_FLASH.ld target=_blank rel=noopener>链接脚本</a>，第二种方法是通过STM32CubeMX生成一个对应微控制器的空工程文件，Toolchain/IDE选择 Makefile，生成代码后，根目录下的<code>STM32F103C8Tx_FLASH.ld</code>文件即为所需链接脚本，可以将该脚本直接放置在项目根目录下。</p><p>按照嵌入式开发习惯创建<code>User</code>文件夹并在其内新建<code>main.c</code>文件编写主程序，此时文件树应如下图所示：</p><p><img src=https://img.ioyoi.me/20240109191257.webp alt=image-20240109191256024></p><p>接下来，在Embedded IDE页配置项目：</p><ul><li><p>在Project Resources添加Normal Folder，将<code>Start</code>和<code>User</code>添加至源文件；（注意，此后如果其他文件夹中编写了源代码，也需要将该文件夹添加进来，否则将不会编译该文件。）</p><p><img src=https://img.ioyoi.me/20240109190117.webp alt=image-20240109190115714></p></li><li><p>在Chip Support Package中添加From Repo->Keil.STM32F1xx_DFP.pack，待支持包下载完成后展开该选项，在STM32F1xx_DFP右侧choose device选择STM32F103C8；</p><p><img src=https://img.ioyoi.me/20240109190258.webp alt=image-20240109190256424></p></li><li><p>Builder Configurations选择GNU Arm Embedded Toolchain(GCC)，CPU Type选择Cortex-M3，Linker Script File Path选择根目录下的链接脚本文件；</p><p><img src=https://img.ioyoi.me/20240109191436.webp alt=image-20240109191434770></p></li><li><p>Flasher Configurations选择OpenOCD，Chip Config选择stm32f1x.cfg，Interface Config选择stlink.cfg；</p><p><img src=https://img.ioyoi.me/20240109191658.webp alt=image-20240109191657288></p><div class="note warning"><p>若你使用其它类型的烧写器，可能需要设置其他的Interface Config，可以通过连接烧写器与开发板后，通过如下命令检查OpenOCD配置是否正确：</p><div class=highlight><div class=chroma><div class=table-container><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=n>openocd</span> <span class=o>-f</span> <span class=n>interface</span><span class=p>/</span><span class=n>stlink</span><span class=p>.</span><span class=py>cfg</span> <span class=o>-f</span> <span class=n>target</span><span class=p>/</span><span class=n>stm32f1x</span><span class=p>.</span><span class=py>cfg</span>
</span></span></code></pre></td></tr></table></div></div></div><p>若输出如图所示，则可以使用上述配置，否则需要尝试其它interface选项。</p><p><img src=https://img.ioyoi.me/20240109192001.webp alt=image-20240109191957164></p></div></li><li><p>在Project Attributes的Include Directories中添加<code>Start</code>和<code>User</code>目录，同样的，如果你之后想要include其他文件夹中的头文件，也需要将它添加至Include Directories，在Preprocessor Definitions中加入上文提到的<code>STM32F10X_MD</code>。</p><p><img src=https://img.ioyoi.me/20240109193005.webp alt=image-20240109193004437></p></li></ul><p>配置完成，现在我们来编写一个最简单的主程序来试试编译吧：</p><div class=highlight><div class=chroma><div class=table-container><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&#34;stm32f10x.h&#34;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>(</span><span class=kt>void</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>while</span><span class=p>(</span><span class=mi>1</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div></div><div class="note primary"><p>嵌入式开发时需要使用死循环阻止主程序结束，防止嵌入式系统进入未定义的状态。</p></div><p>点击Build编译，发现Terminal中报错：</p><pre tabindex=0><code>&gt;&gt; [ 25%] CC &#39;Start/core_cm3.c&#39;
C:\Users\3verness\AppData\Local\Temp\ccSEfmyW.s: Assembler messages:
C:\Users\3verness\AppData\Local\Temp\ccSEfmyW.s:599: Error: registers may not be the same -- `strexb r0,r0,[r1]&#39;
C:\Users\3verness\AppData\Local\Temp\ccSEfmyW.s:629: Error: registers may not be the same -- `strexh r0,r0,[r1]&#39;
</code></pre><p>这是一个<a href=https://github.com/stlink-org/stlink/issues/65 target=_blank rel=noopener>年代久远的错误</a>，<a href=https://gist.github.com/timbrom/1942280 target=_blank rel=noopener>解决方法</a>为将<code>core_cm3.c</code>末尾处的该语句修改为（将<code>"=r"(result)</code>改为<code>"=&amp;r"(result)</code>）：</p><div class=highlight><div class=chroma><div class=table-container><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm> * @brief  STR Exclusive (8 bit)
</span></span></span><span class=line><span class=cl><span class=cm> *
</span></span></span><span class=line><span class=cl><span class=cm> * @param  value  value to store
</span></span></span><span class=line><span class=cl><span class=cm> * @param  *addr  address pointer
</span></span></span><span class=line><span class=cl><span class=cm> * @return        successful / failed
</span></span></span><span class=line><span class=cl><span class=cm> *
</span></span></span><span class=line><span class=cl><span class=cm> * Exclusive STR command for 8 bit values
</span></span></span><span class=line><span class=cl><span class=cm> */</span>
</span></span><span class=line><span class=cl><span class=kt>uint32_t</span> <span class=nf>__STREXB</span><span class=p>(</span><span class=kt>uint8_t</span> <span class=n>value</span><span class=p>,</span> <span class=kt>uint8_t</span> <span class=o>*</span><span class=n>addr</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>   <span class=kt>uint32_t</span> <span class=n>result</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>  <span class=c1>//  __ASM volatile (&#34;strexb %0, %2, [%1]&#34; : &#34;=r&#34; (result) : &#34;r&#34; (addr), &#34;r&#34; (value) );
</span></span></span><span class=line><span class=cl><span class=c1></span>   <span class=n>__ASM</span> <span class=k>volatile</span> <span class=p>(</span><span class=s>&#34;strexb %0, %2, [%1]&#34;</span> <span class=o>:</span> <span class=s>&#34;=&amp;r&#34;</span> <span class=p>(</span><span class=n>result</span><span class=p>)</span> <span class=o>:</span> <span class=s>&#34;r&#34;</span> <span class=p>(</span><span class=n>addr</span><span class=p>),</span> <span class=s>&#34;r&#34;</span> <span class=p>(</span><span class=n>value</span><span class=p>)</span> <span class=p>);</span>
</span></span><span class=line><span class=cl>   <span class=k>return</span><span class=p>(</span><span class=n>result</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm> * @brief  STR Exclusive (16 bit)
</span></span></span><span class=line><span class=cl><span class=cm> *
</span></span></span><span class=line><span class=cl><span class=cm> * @param  value  value to store
</span></span></span><span class=line><span class=cl><span class=cm> * @param  *addr  address pointer
</span></span></span><span class=line><span class=cl><span class=cm> * @return        successful / failed
</span></span></span><span class=line><span class=cl><span class=cm> *
</span></span></span><span class=line><span class=cl><span class=cm> * Exclusive STR command for 16 bit values
</span></span></span><span class=line><span class=cl><span class=cm> */</span>
</span></span><span class=line><span class=cl><span class=kt>uint32_t</span> <span class=nf>__STREXH</span><span class=p>(</span><span class=kt>uint16_t</span> <span class=n>value</span><span class=p>,</span> <span class=kt>uint16_t</span> <span class=o>*</span><span class=n>addr</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>   <span class=kt>uint32_t</span> <span class=n>result</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>  <span class=c1>//  __ASM volatile (&#34;strexh %0, %2, [%1]&#34; : &#34;=r&#34; (result) : &#34;r&#34; (addr), &#34;r&#34; (value) );
</span></span></span><span class=line><span class=cl><span class=c1></span>   <span class=n>__ASM</span> <span class=k>volatile</span> <span class=p>(</span><span class=s>&#34;strexh %0, %2, [%1]&#34;</span> <span class=o>:</span> <span class=s>&#34;=&amp;r&#34;</span> <span class=p>(</span><span class=n>result</span><span class=p>)</span> <span class=o>:</span> <span class=s>&#34;r&#34;</span> <span class=p>(</span><span class=n>addr</span><span class=p>),</span> <span class=s>&#34;r&#34;</span> <span class=p>(</span><span class=n>value</span><span class=p>)</span> <span class=p>);</span>
</span></span><span class=line><span class=cl>   <span class=k>return</span><span class=p>(</span><span class=n>result</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div></div><p>再次编译，在报了一堆warning后显示<code>[ DONE ] build successfully !</code>，恭喜你，你的第一个工程就打包完成了~我们以后会再来处理这些warning的。</p><h2 id=点亮第一颗led><a href=#点亮第一颗led class=anchor-link><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" class="icon anchor-icon"><path d="M326.612 185.391c59.747 59.809 58.927 155.698.36 214.59-.11.12-.24.25-.36.37l-67.2 67.2c-59.27 59.27-155.699 59.262-214.96.0-59.27-59.26-59.27-155.7.0-214.96l37.106-37.106c9.84-9.84 26.786-3.3 27.294 10.606.648 17.722 3.826 35.527 9.69 52.721 1.986 5.822.567 12.262-3.783 16.612l-13.087 13.087c-28.026 28.026-28.905 73.66-1.155 101.96 28.024 28.579 74.086 28.749 102.325.51l67.2-67.19c28.191-28.191 28.073-73.757.0-101.83-3.701-3.694-7.429-6.564-10.341-8.569a16.037 16.037.0 01-6.947-12.606c-.396-10.567 3.348-21.456 11.698-29.806l21.054-21.055c5.521-5.521 14.182-6.199 20.584-1.731a152.482 152.482.0 0120.522 17.197zM467.547 44.449c-59.261-59.262-155.69-59.27-214.96.0l-67.2 67.2c-.12.12-.25.25-.36.37-58.566 58.892-59.387 154.781.36 214.59a152.454 152.454.0 0020.521 17.196c6.402 4.468 15.064 3.789 20.584-1.731l21.054-21.055c8.35-8.35 12.094-19.239 11.698-29.806a16.037 16.037.0 00-6.947-12.606c-2.912-2.005-6.64-4.875-10.341-8.569-28.073-28.073-28.191-73.639.0-101.83l67.2-67.19c28.239-28.239 74.3-28.069 102.325.51 27.75 28.3 26.872 73.934-1.155 101.96l-13.087 13.087c-4.35 4.35-5.769 10.79-3.783 16.612 5.864 17.194 9.042 34.999 9.69 52.721.509 13.906 17.454 20.446 27.294 10.606l37.106-37.106c59.271-59.259 59.271-155.699.001-214.959z"/></svg></a>点亮第一颗LED</h2><p>学硬件的第一步永远都是点灯，无需连接其他模块，江协的STM32核心板上便留有两颗LED，D1是电源指示灯，上电常亮，D2一端连接VCC，一段接PC13，即GPIO C的13引脚，当PC13拉高，LED熄灭，PC13拉低，LED点亮，让我们就从这颗D2开始吧！</p><p><img src=https://img.ioyoi.me/20240109195017.webp alt=image-20240109195015932></p><p>在STM32中，通过寄存器控制某一特定GPIO端口需要三个步骤：</p><ol><li><p>开启对应IO端口时钟使能，其中GPIOC连接在APB2总线上，通过<code>RCC_APB2ENR</code>寄存器设置，即需要将该寄存器第4位置1；</p><p><img src=https://img.ioyoi.me/20240109200544.webp alt=image-20240109200542384></p><pre tabindex=0><code>Bit 4 IOPCEN: IO port C clock enable
Set and cleared by software.
0: IO port C clock disabled
1: IO port C clock enabled
</code></pre></li><li><p>设置对应IO端口为推挽输出，GPIOC 13Pin的工作模式由<code>GPIOC_CRH</code>寄存器设置，即需要将该寄存器[23:22]设置为00，[21:20]设置为11（50MHz工作）；</p><p><img src=https://img.ioyoi.me/20240109201405.webp alt=image-20240109201403802></p><pre tabindex=0><code>CNFy[1:0]: Port x configuration bits (y= 8 .. 15)
These bits are written by software to configure the corresponding I/O port.
In input mode (MODE[1:0]=00):
00: Analog mode
01: Floating input (reset state)
10: Input with pull-up / pull-down
11: Reserved
In output mode (MODE[1:0] &gt; 00):
00: General purpose output push-pull
01: General purpose output Open-drain
10: Alternate function output Push-pull
11: Alternate function output Open-drain

MODEy[1:0]: Port x mode bits (y= 8 .. 15)
These bits are written by software to configure the corresponding I/O port.
00: Input mode (reset state)
01: Output mode, max speed 10 MHz.
10: Output mode, max speed 2 MHz.
11: Output mode, max speed 50 MHz
</code></pre></li><li><p>改变指定端口输出寄存器的值，即改变<code>GPIOC_ODR</code>中的13位的值。</p><p><img src=https://img.ioyoi.me/20240109203102.webp alt=image-20240109203101270></p><pre tabindex=0><code>ODRy: Port output data (y= 0 .. 15)
These bits can be read and written by software and can be accessed in Word mode only
</code></pre><div class="note info"><p>以上是江协科技视频中给出的置位与复位方式，但个人认为这是一种不太好的方法，因为该方法同时改变了所有IO输出寄存器的值，更好的方式应当是操作<code>GPIOC_BSRR</code>寄存器，置位时，向13位写1，复位时，向29位写1。</p><p><img src=https://img.ioyoi.me/20240109203035.webp alt=image-20240109203034103></p><pre tabindex=0><code>BRy: Port x Reset bit y (y= 0 .. 15)
These bits are write-only and can be accessed in Word mode only.
0: No action on the corresponding ODRx bit
1: Reset the corresponding ODRx bit

BSy: Port x Set bit y (y= 0 .. 15)
These bits are write-only and can be accessed in Word mode only.
0: No action on the corresponding ODRx bit
1: Set the corresponding ODRx bit
</code></pre></div></li></ol><p>因此，<code>main</code>函数应当这样编写：</p><div class=highlight><div class=chroma><div class=table-container><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&#34;stm32f10x.h&#34;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>(</span><span class=kt>void</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>RCC</span><span class=o>-&gt;</span><span class=n>APB2ENR</span> <span class=o>=</span> <span class=mh>0x00000010</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>GPIOC</span><span class=o>-&gt;</span><span class=n>CRH</span> <span class=o>=</span> <span class=mh>0x00300000</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>GPIOC</span><span class=o>-&gt;</span><span class=n>ODR</span> <span class=o>=</span> <span class=mh>0x00000000</span><span class=p>;</span> <span class=c1>//开灯
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=c1>// GPIOC-&gt;ODR = 0x00002000; //关灯
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>while</span><span class=p>(</span><span class=mi>1</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div></div><p>点击编译、烧写，若OpenOCD配置成功，Terminal中会出现：</p><pre tabindex=0><code>** Programming Started **
Info : device id = 0x20036410
Info : flash size = 64 KiB
Warn : Adding extra erase range, 0x08000338 .. 0x080003ff
** Programming Finished **
** Verify Started **
** Verified OK **
</code></pre><p>此时便可以通过更换<code>main</code>函数，反复刷写控制灯光亮灭了。一个简单的亮灯程序就这样完成了，虽然代码并不长，但可读性很差，相信对于初学者来说，如果没有注释，必须查阅参考手册才能知道每个语句的具体含义，这也是基于寄存器从底层开发的劣势所在，在后文中，我们将学习如何使用库函数实现相同的功能。</p><h2 id=浅尝调试><a href=#浅尝调试 class=anchor-link><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" class="icon anchor-icon"><path d="M326.612 185.391c59.747 59.809 58.927 155.698.36 214.59-.11.12-.24.25-.36.37l-67.2 67.2c-59.27 59.27-155.699 59.262-214.96.0-59.27-59.26-59.27-155.7.0-214.96l37.106-37.106c9.84-9.84 26.786-3.3 27.294 10.606.648 17.722 3.826 35.527 9.69 52.721 1.986 5.822.567 12.262-3.783 16.612l-13.087 13.087c-28.026 28.026-28.905 73.66-1.155 101.96 28.024 28.579 74.086 28.749 102.325.51l67.2-67.19c28.191-28.191 28.073-73.757.0-101.83-3.701-3.694-7.429-6.564-10.341-8.569a16.037 16.037.0 01-6.947-12.606c-.396-10.567 3.348-21.456 11.698-29.806l21.054-21.055c5.521-5.521 14.182-6.199 20.584-1.731a152.482 152.482.0 0120.522 17.197zM467.547 44.449c-59.261-59.262-155.69-59.27-214.96.0l-67.2 67.2c-.12.12-.25.25-.36.37-58.566 58.892-59.387 154.781.36 214.59a152.454 152.454.0 0020.521 17.196c6.402 4.468 15.064 3.789 20.584-1.731l21.054-21.055c8.35-8.35 12.094-19.239 11.698-29.806a16.037 16.037.0 00-6.947-12.606c-2.912-2.005-6.64-4.875-10.341-8.569-28.073-28.073-28.191-73.639.0-101.83l67.2-67.19c28.239-28.239 74.3-28.069 102.325.51 27.75 28.3 26.872 73.934-1.155 101.96l-13.087 13.087c-4.35 4.35-5.769 10.79-3.783 16.612 5.864 17.194 9.042 34.999 9.69 52.721.509 13.906 17.454 20.446 27.294 10.606l37.106-37.106c59.271-59.259 59.271-155.699.001-214.959z"/></svg></a>浅尝调试</h2><p>最后，让我们来简单尝试一下Embedded IDE集成的调试功能，打开<code>.vscode</code>目录下的<code>launch.json</code>，删除多余项，仅保留使用OpenOCD的配置项：</p><div class=highlight><div class=chroma><div class=table-container><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;version&#34;</span><span class=p>:</span> <span class=s2>&#34;0.2.0&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;configurations&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;cwd&#34;</span><span class=p>:</span> <span class=s2>&#34;${workspaceRoot}&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;type&#34;</span><span class=p>:</span> <span class=s2>&#34;cortex-debug&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;request&#34;</span><span class=p>:</span> <span class=s2>&#34;launch&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;name&#34;</span><span class=p>:</span> <span class=s2>&#34;openocd&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;servertype&#34;</span><span class=p>:</span> <span class=s2>&#34;openocd&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;executable&#34;</span><span class=p>:</span> <span class=s2>&#34;build\\Debug\\Template.elf&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;runToEntryPoint&#34;</span><span class=p>:</span> <span class=s2>&#34;main&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;configFiles&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>                <span class=s2>&#34;interface/stlink.cfg&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=s2>&#34;target/stm32f1x.cfg&#34;</span>
</span></span><span class=line><span class=cl>            <span class=p>],</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;toolchainPrefix&#34;</span><span class=p>:</span> <span class=s2>&#34;arm-none-eabi&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;svdFile&#34;</span><span class=p>:</span> <span class=s2>&#34;.pack/Keil/STM32F1xx_DFP.2.3.0/SVD/STM32F103xx.svd&#34;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>]</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div></div><p>选择左侧的Debug标签栏，确定当前Debug名称为<code>openocd</code>，按Start Debugging开始，稍等一会后，程序暂停在主程序的开始处，此时可以单步运行，并在左侧XPERIPHERALS栏查看微控制器中各寄存器的值，此时还可以使用gdb的全部调试功能。</p><p><img src=https://img.ioyoi.me/20240109204947.webp alt=image-20240109204945144></p><p>值得注意的是，Debug只会利用编译中生成的<code>elf</code>文件进行调试，并不会自动重新编译文件，因此每次修改源文件后，都需要手动Rebuild才可以进行调试。</p><h2 id=认识标准库><a href=#认识标准库 class=anchor-link><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" class="icon anchor-icon"><path d="M326.612 185.391c59.747 59.809 58.927 155.698.36 214.59-.11.12-.24.25-.36.37l-67.2 67.2c-59.27 59.27-155.699 59.262-214.96.0-59.27-59.26-59.27-155.7.0-214.96l37.106-37.106c9.84-9.84 26.786-3.3 27.294 10.606.648 17.722 3.826 35.527 9.69 52.721 1.986 5.822.567 12.262-3.783 16.612l-13.087 13.087c-28.026 28.026-28.905 73.66-1.155 101.96 28.024 28.579 74.086 28.749 102.325.51l67.2-67.19c28.191-28.191 28.073-73.757.0-101.83-3.701-3.694-7.429-6.564-10.341-8.569a16.037 16.037.0 01-6.947-12.606c-.396-10.567 3.348-21.456 11.698-29.806l21.054-21.055c5.521-5.521 14.182-6.199 20.584-1.731a152.482 152.482.0 0120.522 17.197zM467.547 44.449c-59.261-59.262-155.69-59.27-214.96.0l-67.2 67.2c-.12.12-.25.25-.36.37-58.566 58.892-59.387 154.781.36 214.59a152.454 152.454.0 0020.521 17.196c6.402 4.468 15.064 3.789 20.584-1.731l21.054-21.055c8.35-8.35 12.094-19.239 11.698-29.806a16.037 16.037.0 00-6.947-12.606c-2.912-2.005-6.64-4.875-10.341-8.569-28.073-28.073-28.191-73.639.0-101.83l67.2-67.19c28.239-28.239 74.3-28.069 102.325.51 27.75 28.3 26.872 73.934-1.155 101.96l-13.087 13.087c-4.35 4.35-5.769 10.79-3.783 16.612 5.864 17.194 9.042 34.999 9.69 52.721.509 13.906 17.454 20.446 27.294 10.606l37.106-37.106c59.271-59.259 59.271-155.699.001-214.959z"/></svg></a>认识标准库</h2><p>上两个章节中，我们使用寄存器开发了一个简单的亮灯程序，现在我们将使用标准库重新实现该功能。</p><p>若想使用标准库，首先我们需要将标准库中<code>Libraries\STM32F10x_StdPeriph_Driver</code>中<code>inc</code>文件夹下的库头文件与<code>src</code>下的源文件添加至项目中，我们新建一个<code>Library</code>文件夹存放这些标准库文件，同样别忘了将<code>Library</code>文件夹添加至Embedded IDE的Project Resources和Include Directories。</p><p>此外，我们还需要额外的三个文件对这些头文件进行导入以及中断定义，均可以在标准库下的<code>Project\STM32F10x_StdPeriph_Template</code>内找到：</p><ul><li><p><code>stm32f10x_conf.h</code></p><p>用于包含标准库头文件，并提供标准库函数参数检查函数定义；</p></li><li><p><code>stm32f10x_it.h/c</code></p><p>定义标准库中的中断函数。</p></li></ul><p>由于上述文件可能需要更改，可以将它们放置在<code>User</code>目录下，此时项目文件树结构可参照<a href>该模板工程</a>。</p><p>最后留意到<code>stm32f10x.h</code>结尾处语句：</p><div class=highlight><div class=chroma><div class=table-container><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=cp>#ifdef USE_STDPERIPH_DRIVER
</span></span></span><span class=line><span class=cl><span class=cp></span>  <span class=cp>#include</span> <span class=cpf>&#34;stm32f10x_conf.h&#34;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#endif
</span></span></span></code></pre></td></tr></table></div></div></div><p>因此为导入标准库，需要在预处理器中定义<code>USE_STDPERIPH_DRIVER</code>，即在Preprocessor Definations中添加该项。</p><p>在<code>main.c</code>中输入<code>GPIO</code>会发现出现一系列自动补全的库函数，说明标准库已经成功导入。</p><p>让我们用标准库重写该功能，寄存器配置语句注释在对应的库函数语句下方，这里我建议去看看江协科技<a href="https://www.bilibili.com/video/BV1th411z7sn?t=1411.4&amp;p=4" target=_blank rel=noopener>2-2课时</a>该部分的库函数编写流程，包含了查阅注释、寻找可选参数的编程过程，值得一提的是，由于VS Code可以读取格式化注释，将鼠标移至函数名称处即可显示可选参数，比Keil要方便不少：</p><div class=highlight><div class=chroma><div class=table-container><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&#34;stm32f10x.h&#34;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>(</span><span class=kt>void</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// 打开外设时钟
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nf>RCC_APB2PeriphClockCmd</span><span class=p>(</span><span class=n>RCC_APB2Periph_GPIOC</span><span class=p>,</span> <span class=n>ENABLE</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=c1>// RCC-&gt;APB2ENR = 0x00000010;
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>    <span class=c1>// 设置端口推挽输出
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=n>GPIO_InitTypeDef</span> <span class=n>GPIO_InitStructure</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>GPIO_InitStructure</span><span class=p>.</span><span class=n>GPIO_Mode</span> <span class=o>=</span> <span class=n>GPIO_Mode_Out_PP</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>GPIO_InitStructure</span><span class=p>.</span><span class=n>GPIO_Pin</span> <span class=o>=</span> <span class=n>GPIO_Pin_13</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>GPIO_InitStructure</span><span class=p>.</span><span class=n>GPIO_Speed</span> <span class=o>=</span> <span class=n>GPIO_Speed_50MHz</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=nf>GPIO_Init</span><span class=p>(</span><span class=n>GPIOC</span><span class=p>,</span> <span class=o>&amp;</span><span class=n>GPIO_InitStructure</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=c1>// GPIOC-&gt;CRH = 0x00300000;
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>    <span class=c1>// 复位
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nf>GPIO_ResetBits</span><span class=p>(</span><span class=n>GPIOC</span><span class=p>,</span> <span class=n>GPIO_Pin_13</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=c1>// GPIOC-&gt;ODR = 0x00000000;
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>    <span class=c1>// 置位
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nf>GPIO_SetBits</span><span class=p>(</span><span class=n>GPIOC</span><span class=p>,</span> <span class=n>GPIO_Pin_13</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=c1>// GPIOC-&gt;ODR = 0x00002000; //关灯
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>    <span class=k>while</span><span class=p>(</span><span class=mi>1</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div></div><p>可以看到，库函数的代码比寄存器配置要繁琐的多，那么使用库函数的优势何在呢？让我们回顾一下寄存器开发的流程，当我们想实现一个设置时，首先要寻找控制该设置的寄存器，在参考手册中查找该寄存器对应的名称及各位含义，按照含义配置寄存器的零一值；而库函数开发则变为，查找设置该项的函数，查看该函数各参数的可选项，选择合适的可选项填入，其中大部分查找功能可以通过编辑器完成，同时函数名也具有更高的可读性，这就极大的提升了开发效率，以下两张GIF可以直观地反应两种方式开发的效率对比。</p><p><img src=https://img.ioyoi.me/20240110121901.webp alt=1><span class=caption>◎ 寄存器开发</span></p><p><img src=https://img.ioyoi.me/20240110121902.webp alt=1><span class=caption>◎ 库函数开发</span></p><p>此外，我们观察库函数的具体实现：</p><div class=highlight><div class=chroma><div class=table-container><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=kt>void</span> <span class=nf>RCC_APB2PeriphClockCmd</span><span class=p>(</span><span class=kt>uint32_t</span> <span class=n>RCC_APB2Periph</span><span class=p>,</span> <span class=n>FunctionalState</span> <span class=n>NewState</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=cm>/* Check the parameters */</span>
</span></span><span class=line><span class=cl>  <span class=nf>assert_param</span><span class=p>(</span><span class=nf>IS_RCC_APB2_PERIPH</span><span class=p>(</span><span class=n>RCC_APB2Periph</span><span class=p>));</span>
</span></span><span class=line><span class=cl>  <span class=nf>assert_param</span><span class=p>(</span><span class=nf>IS_FUNCTIONAL_STATE</span><span class=p>(</span><span class=n>NewState</span><span class=p>));</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span><span class=n>NewState</span> <span class=o>!=</span> <span class=n>DISABLE</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>RCC</span><span class=o>-&gt;</span><span class=n>APB2ENR</span> <span class=o>|=</span> <span class=n>RCC_APB2Periph</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=k>else</span>
</span></span><span class=line><span class=cl>  <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>RCC</span><span class=o>-&gt;</span><span class=n>APB2ENR</span> <span class=o>&amp;=</span> <span class=o>~</span><span class=n>RCC_APB2Periph</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div></div><p>发现库函数会逐一对参数进行参数检查，并通过<code>|=</code>与<code>&=</code>对寄存器单个位进行置位和复位，最大程度的避免了我们的粗心犯错，同时也不会对其他无关项造成影响，相较使用寄存器更为安全省心。</p><h2 id=打包模板><a href=#打包模板 class=anchor-link><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" class="icon anchor-icon"><path d="M326.612 185.391c59.747 59.809 58.927 155.698.36 214.59-.11.12-.24.25-.36.37l-67.2 67.2c-59.27 59.27-155.699 59.262-214.96.0-59.27-59.26-59.27-155.7.0-214.96l37.106-37.106c9.84-9.84 26.786-3.3 27.294 10.606.648 17.722 3.826 35.527 9.69 52.721 1.986 5.822.567 12.262-3.783 16.612l-13.087 13.087c-28.026 28.026-28.905 73.66-1.155 101.96 28.024 28.579 74.086 28.749 102.325.51l67.2-67.19c28.191-28.191 28.073-73.757.0-101.83-3.701-3.694-7.429-6.564-10.341-8.569a16.037 16.037.0 01-6.947-12.606c-.396-10.567 3.348-21.456 11.698-29.806l21.054-21.055c5.521-5.521 14.182-6.199 20.584-1.731a152.482 152.482.0 0120.522 17.197zM467.547 44.449c-59.261-59.262-155.69-59.27-214.96.0l-67.2 67.2c-.12.12-.25.25-.36.37-58.566 58.892-59.387 154.781.36 214.59a152.454 152.454.0 0020.521 17.196c6.402 4.468 15.064 3.789 20.584-1.731l21.054-21.055c8.35-8.35 12.094-19.239 11.698-29.806a16.037 16.037.0 00-6.947-12.606c-2.912-2.005-6.64-4.875-10.341-8.569-28.073-28.073-28.191-73.639.0-101.83l67.2-67.19c28.239-28.239 74.3-28.069 102.325.51 27.75 28.3 26.872 73.934-1.155 101.96l-13.087 13.087c-4.35 4.35-5.769 10.79-3.783 16.612 5.864 17.194 9.042 34.999 9.69 52.721.509 13.906 17.454 20.446 27.294 10.606l37.106-37.106c59.271-59.259 59.271-155.699.001-214.959z"/></svg></a>打包模板</h2><p>由于我们以后会经常创建新工程，每次都重新复制文件过于麻烦，这里推荐将该工程打包成模板(<code>.ept</code>)，便于日后直接创建基于库函数的Embedded IDE工程。在Embedded IDE页右键该工程选择Export Eide Project Template，该操作会在项目根目录下生成一个<code>.ept</code>文件，这便是我们的模板文件，此后新建工程时，只需要选择New Project->Local Template，选择该模板文件即可生成一个除名称位置外与当前工程完全一样的新工程，无需再做任何配置！</p><p><img src=https://img.ioyoi.me/20240110123154.webp alt=image-20240110123152356></p><p>恭喜你，你已经踏出了学习STM32的第一步，相较Keil，开源工具链的配置过程确实要繁琐的多，但你已经成功克服了大多数阻碍，现在，你便可以在一个现代化的UI界面里愉快的编写嵌入式代码了~在下一篇文章中，我们将从GPIO开始，一步步认识STM32的外设操作，一起向点灯大师进发吧！</p></div></article><div class=post-share><div class=share-items><div class="share-item facebook"><a href="https://www.facebook.com/sharer/sharer.php?u=https://ioyoi.me/tech/learn-stm32-1/&amp;hashtag=%23stm32" title=分享到「Facebook」 target=_blank rel=noopener><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" class="icon facebook-icon"><path d="M504 256C504 119 393 8 256 8S8 119 8 256c0 123.78 90.69 226.38 209.25 245V327.69h-63V256h63v-54.64c0-62.15 37-96.48 93.67-96.48 27.14.0 55.52 4.84 55.52 4.84v61h-31.28c-30.8.0-40.41 19.12-40.41 38.73V256h68.78l-11 71.69h-57.78V501C413.31 482.38 504 379.78 504 256z"/></svg></a></div><div class="share-item mastodon"><a href="/fedishare.html#title=Learn%20STM32%20the%20Hard%20Way%c2%b71%20%e4%bb%8e%e7%82%b9%e7%81%af%e5%bc%80%e5%a7%8b&amp;description=What%27s%20the%20hard%20way?%20%e7%bd%91%e4%b8%8a%e5%b7%b2%e7%bb%8f%e6%9c%89%e8%ae%b8%e5%a4%9a%e9%9d%9e%e5%b8%b8%e6%88%90%e7%86%9f%e7%9a%84%e5%9f%ba%e4%ba%8eKeil%e7%9a%84STM32%e7%9a%84%e5%bc%80%e5%8f%91%e6%95%99%e7%a8%8b%ef%bc%8c%e8%80%8c%e6%9c%ac%e7%b3%bb%e5%88%97%e6%96%87%e7%ab%a0%e5%8f%8d%e5%85%b6%e2%80%a6%e2%80%a6&amp;url=https://ioyoi.me/tech/learn-stm32-1/" title=分享到「Mastodon」 target=_blank rel=noopener><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512" class="icon mastodon-icon"><path d="M433 179.11c0-97.2-63.71-125.7-63.71-125.7-62.52-28.7-228.56-28.4-290.48.0.0.0-63.72 28.5-63.72 125.7.0 115.7-6.6 259.4 105.63 289.1 40.51 10.7 75.32 13 103.33 11.4 50.81-2.8 79.32-18.1 79.32-18.1l-1.7-36.9s-36.31 11.4-77.12 10.1c-40.41-1.4-83-4.4-89.63-54a102.54 102.54.0 01-.9-13.9c85.63 20.9 158.65 9.1 178.75 6.7 56.12-6.7 105-41.3 111.23-72.9 9.8-49.8 9-121.5 9-121.5zm-75.12 125.2h-46.63v-114.2c0-49.7-64-51.6-64 6.9v62.5h-46.33V197c0-58.5-64-56.6-64-6.9v114.2H90.19c0-122.1-5.2-147.9 18.41-175 25.9-28.9 79.82-30.8 103.83 6.1l11.6 19.5 11.6-19.5c24.11-37.1 78.12-34.8 103.83-6.1 23.71 27.3 18.4 53 18.4 175z"/></svg></a></div><div class="share-item fediverse"><a href="/fedishare.html#title=Learn%20STM32%20the%20Hard%20Way%c2%b71%20%e4%bb%8e%e7%82%b9%e7%81%af%e5%bc%80%e5%a7%8b&amp;description=What%27s%20the%20hard%20way?%20%e7%bd%91%e4%b8%8a%e5%b7%b2%e7%bb%8f%e6%9c%89%e8%ae%b8%e5%a4%9a%e9%9d%9e%e5%b8%b8%e6%88%90%e7%86%9f%e7%9a%84%e5%9f%ba%e4%ba%8eKeil%e7%9a%84STM32%e7%9a%84%e5%bc%80%e5%8f%91%e6%95%99%e7%a8%8b%ef%bc%8c%e8%80%8c%e6%9c%ac%e7%b3%bb%e5%88%97%e6%96%87%e7%ab%a0%e5%8f%8d%e5%85%b6%e2%80%a6%e2%80%a6&amp;url=https://ioyoi.me/tech/learn-stm32-1/" title=分享到「Fediverse」 target=_blank rel=noopener><svg xmlns="http://www.w3.org/2000/svg" viewBox="64 163 873 873" class="icon fediverse-icon"><defs><linearGradient id="fediverse-gradient"><stop offset="0" stop-color="#ff0101"/><stop offset="10%" stop-color="#9501ff"/><stop offset="50%" stop-color="#ffca01"/><stop offset="75%" stop-color="#01a3ff"/><stop offset="100%" stop-color="#65ff01"/></linearGradient></defs><path d="M539 176q-32 0-55 22t-25 55 20.5 58 56 27 58.5-20.5 27-56-20.5-59T544 176h-5zm-87 95-232 118q20 20 25 48l231-118q-19-20-24-48zm167 27q-13 25-38 38l183 184q13-25 39-38zM477 320 342 585l40 40 143-280q-28-5-48-25zm104 16q-22 11-46 10l-8-1 21 132 56 9zM155 370q-32 0-55 22.5t-25 55 20.5 58 56.5 27 59-21 26.5-56-21-58.5-55.5-27h-6zm90 68q1 9 1 18-1 19-10 35l132 21 26-50zm225 36-26 51 311 49q-1-8-1-17 1-19 10-36zm372 6q-32 1-55 23t-24.5 55 21 58 56 27 58.5-20.5 27-56.5-20.5-59-56.5-27h-6zM236 493q-13 25-39 38l210 210 51-25zm-40 38q-21 11-44 10l-9-1 40 256q21-10 45-9l8 1zm364 22 48 311q21-10 44-9l10 1-46-294zm195 23-118 60 8 56 135-68q-20-20-25-48zm26 49-119 231q28 5 48 25l119-231q-28-5-48-25zM306 654l-68 134q28 5 48 25l60-119zm262 17-281 143q19 20 24 48l265-135zM513 771l-51 25 106 107q13-25 39-38zM222 795q-32 0-55.5 22.5t-25 55 21 57.5 56 27 58.5-20.5 27-56-20.5-58.5-56.5-27h-5zm89 68q2 9 1 18-1 19-9 35l256 41q-1-9-1-18 1-18 10-35zm335 0q-32 0-55 22.5t-24.5 55 20.5 58 56 27 59-21 27-56-20.5-58.5-56.5-27h-6z"/></svg></a></div><div class="share-item twitter"><a href="https://twitter.com/share?url=https://ioyoi.me/tech/learn-stm32-1/&amp;text=Learn%20STM32%20the%20Hard%20Way%c2%b71%20%e4%bb%8e%e7%82%b9%e7%81%af%e5%bc%80%e5%a7%8b&amp;hashtags=stm32,tutorial,&amp;via=ShaohangWang" title=分享到「Twitter」 target=_blank rel=noopener><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" class="icon twitter-icon"><path d="M459.37 151.716c.325 4.548.325 9.097.325 13.645.0 138.72-105.583 298.558-298.558 298.558-59.452.0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055.0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421.0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391.0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04.0-57.828 46.782-104.934 104.934-104.934 30.213.0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"/></svg></a></div></div></div><div class=related-posts><h2 class=related-title>相关文章：<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" class="icon related-icon"><path d="M256 8C119 8 8 119 8 256s111 248 248 248 248-111 248-248S393 8 256 8zm144 276c0 6.6-5.4 12-12 12h-92v92c0 6.6-5.4 12-12 12h-56c-6.6.0-12-5.4-12-12v-92h-92c-6.6.0-12-5.4-12-12v-56c0-6.6 5.4-12 12-12h92v-92c0-6.6 5.4-12 12-12h56c6.6.0 12 5.4 12 12v92h92c6.6.0 12 5.4 12 12v56z"/></svg></h2><ul class=related-list><li class=related-item><a href=/tech/learn-stm32-2/ class=related-link>Learn STM32 the Hard Way·2 认识GPIO</a></li><li class=related-item><a href=/tech/verilator-tutorial/ class=related-link>Verilator仿真器入门</a></li><li class=related-item><a href=/tech/pynq-1-verilog-ip/ class=related-link>PYNQ学习·第一个IP核</a></li></ul></div><div class=post-tags><a href=/tags/stm32/ rel=tag class=post-tags-link><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" class="icon tag-icon"><path d="M0 252.118V48C0 21.49 21.49.0 48 0h204.118a48 48 0 0133.941 14.059l211.882 211.882c18.745 18.745 18.745 49.137.0 67.882L293.823 497.941c-18.745 18.745-49.137 18.745-67.882.0L14.059 286.059A48 48 0 010 252.118zM112 64c-26.51.0-48 21.49-48 48s21.49 48 48 48 48-21.49 48-48-21.49-48-48-48z"/></svg>stm32</a>
<a href=/tags/tutorial/ rel=tag class=post-tags-link><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" class="icon tag-icon"><path d="M0 252.118V48C0 21.49 21.49.0 48 0h204.118a48 48 0 0133.941 14.059l211.882 211.882c18.745 18.745 18.745 49.137.0 67.882L293.823 497.941c-18.745 18.745-49.137 18.745-67.882.0L14.059 286.059A48 48 0 010 252.118zM112 64c-26.51.0-48 21.49-48 48s21.49 48 48 48 48-21.49 48-48-21.49-48-48-48z"/></svg>tutorial</a></div><ul class=post-nav><li class=post-nav-prev><a href=/tech/learn-stm32-2/ rel=prev>&lt; Learn STM32 the Hard Way·2 认识GPIO</a></li><li class=post-nav-next><a href=/tech/verilator-tutorial/ rel=next>Verilator仿真器入门 ></a></li></ul><div class=load-comments><div id=load-comments>加载评论</div></div><div id=disqus_thread></div></div></main><div id=back-to-top class=back-to-top><a href=#><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512" class="icon arrow-up"><path d="M34.9 289.5l-22.2-22.2c-9.4-9.4-9.4-24.6.0-33.9L207 39c9.4-9.4 24.6-9.4 33.9.0l194.3 194.3c9.4 9.4 9.4 24.6.0 33.9L413 289.4c-9.5 9.5-25 9.3-34.3-.4L264 168.6V456c0 13.3-10.7 24-24 24h-32c-13.3.0-24-10.7-24-24V168.6L69.2 289.1c-9.3 9.8-24.8 10-34.3.4z"/></svg></a></div><footer id=footer class=footer><div class=footer-inner><div class=site-info>©&nbsp;2020–2024&nbsp;<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" class="icon footer-icon"><path d="M462.3 62.6C407.5 15.9 326 24.3 275.7 76.2L256 96.5l-19.7-20.3C186.1 24.3 104.5 15.9 49.7 62.6c-62.8 53.6-66.1 149.8-9.9 207.9l193.5 199.8c12.5 12.9 32.8 12.9 45.3.0l193.5-199.8c56.3-58.1 53-154.3-9.8-207.9z"/></svg></div><div class=powered-by>Powered by <a href=https://github.com/gohugoio/hugo target=_blank rel=noopener>Hugo</a> | Theme is <a href=https://github.com/reuixiy/hugo-theme-meme target=_blank rel=noopener>MemE</a></div><div class=custom-footer><a href="https://icp.gov.moe/?keyword=20230416" target=_blank rel=noopener>萌ICP备20230416号</a></div></div></footer></div><script>"serviceWorker"in navigator&&window.addEventListener("load",function(){navigator.serviceWorker.register("/sw.js")})</script><script>function loadComments(){if(!document.getElementById("disqus_thread"))return;if(typeof DISQUS=="undefined"){const e=function(){this.page.url="https://ioyoi.me/tech/learn-stm32-1/",this.page.identifier="/tech/learn-stm32-1/",this.page.title="Learn STM32 the Hard Way·1 从点灯开始"};(function(){const t=document,e=t.createElement("script");e.async=!0,e.src="https://ioyoi.disqus.com/embed.js",e.setAttribute("data-timestamp",+new Date),(t.head||t.body).appendChild(e)})()}else DISQUS.reset({reload:!0,config:function(){this.page.url="https://ioyoi.me/tech/learn-stm32-1/",this.page.identifier="/tech/learn-stm32-1/",this.page.title="Learn STM32 the Hard Way·1 从点灯开始"}})}</script><script src=https://cdn.jsdelivr.net/npm/medium-zoom@latest/dist/medium-zoom.min.js></script><script>let imgNodes=document.querySelectorAll("div.post-body img");imgNodes=Array.from(imgNodes).filter(e=>e.parentNode.tagName!=="A"),mediumZoom(imgNodes,{background:"hsla(var(--color-bg-h), var(--color-bg-s), var(--color-bg-l), 0.95)"})</script><script src=https://cdn.jsdelivr.net/npm/instant.page@5.1.0/instantpage.min.js type=module defer></script></body></html>